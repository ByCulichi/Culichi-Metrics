daily_data = [
    # Abril
    {'Mes': 'Abril', 'Call Date': '2025-04-01', 'HANDLED': 35, 'OIR (%)': 100.0, 'AHT (seg)': 560.2, 'PS & Compliance (%)': 100.0, 'RTA (%)': 90.0, 'Availability (%)': 99.6},
    {'Mes': 'Abril', 'Call Date': '2025-04-02', 'HANDLED': 32, 'OIR (%)': 100.0, 'AHT (seg)': 575.1, 'PS & Compliance (%)': 100.0, 'RTA (%)': 85.0, 'Availability (%)': 99.7},
    {'Mes': 'Abril', 'Call Date': '2025-04-03', 'HANDLED': 38, 'OIR (%)': 100.0, 'AHT (seg)': 590.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 88.0, 'Availability (%)': 99.5},
    {'Mes': 'Abril', 'Call Date': '2025-04-04', 'HANDLED': 30, 'OIR (%)': 100.0, 'AHT (seg)': 545.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 92.0, 'Availability (%)': 99.8},
    {'Mes': 'Abril', 'Call Date': '2025-04-05', 'HANDLED': 40, 'OIR (%)': 100.0, 'AHT (seg)': 600.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 95.0, 'Availability (%)': 99.6},
    {'Mes': 'Abril', 'Call Date': '2025-04-06', 'HANDLED': 33, 'OIR (%)': 100.0, 'AHT (seg)': 570.0, 'PS & Compliance (%)': 50.0, 'RTA (%)': 87.0, 'Availability (%)': 99.7},
    {'Mes': 'Abril', 'Call Date': '2025-04-07', 'HANDLED': 37, 'OIR (%)': 100.0, 'AHT (seg)': 585.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 89.0, 'Availability (%)': 99.6},
    {'Mes': 'Abril', 'Call Date': '2025-04-08', 'HANDLED': 34, 'OIR (%)': 100.0, 'AHT (seg)': 550.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 93.0, 'Availability (%)': 99.8},
    {'Mes': 'Abril', 'Call Date': '2025-04-09', 'HANDLED': 36, 'OIR (%)': 100.0, 'AHT (seg)': 595.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 86.0, 'Availability (%)': 99.5},
    {'Mes': 'Abril', 'Call Date': '2025-04-10', 'HANDLED': 31, 'OIR (%)': 100.0, 'AHT (seg)': 565.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 91.0, 'Availability (%)': 99.7},
    {'Mes': 'Abril', 'Call Date': '2025-04-11', 'HANDLED': None, 'OIR (%)': None, 'AHT (seg)': None, 'PS & Compliance (%)': None, 'RTA (%)': None, 'Availability (%)': None},
    {'Mes': 'Abril', 'Call Date': '2025-04-12', 'HANDLED': 40, 'OIR (%)': 100.0, 'AHT (seg)': 540.3, 'PS & Compliance (%)': 100.0, 'RTA (%)': 94.1, 'Availability (%)': 99.1},
    {'Mes': 'Abril', 'Call Date': '2025-04-14', 'HANDLED': 39, 'OIR (%)': 100.0, 'AHT (seg)': 675.7, 'PS & Compliance (%)': 100.0, 'RTA (%)': 96.3, 'Availability (%)': 100.0},
    {'Mes': 'Abril', 'Call Date': '2025-04-15', 'HANDLED': 32, 'OIR (%)': 100.0, 'AHT (seg)': 586.3, 'PS & Compliance (%)': 100.0, 'RTA (%)': 81.2, 'Availability (%)': 99.9},
    {'Mes': 'Abril', 'Call Date': '2025-04-16', 'HANDLED': 40, 'OIR (%)': 100.0, 'AHT (seg)': 540.2, 'PS & Compliance (%)': 57.5, 'RTA (%)': 98.2, 'Availability (%)': 99.8},
    {'Mes': 'Abril', 'Call Date': '2025-04-17', 'HANDLED': 45, 'OIR (%)': 100.0, 'AHT (seg)': 449.3, 'PS & Compliance (%)': 87.5, 'RTA (%)': 93.6, 'Availability (%)': 99.9},
    {'Mes': 'Abril', 'Call Date': '2025-04-19', 'HANDLED': 42, 'OIR (%)': 100.0, 'AHT (seg)': 478.8, 'PS & Compliance (%)': 100.0, 'RTA (%)': 94.6, 'Availability (%)': 99.5},
    {'Mes': 'Abril', 'Call Date': '2025-04-21', 'HANDLED': 33, 'OIR (%)': 100.0, 'AHT (seg)': 572.3, 'PS & Compliance (%)': 100.0, 'RTA (%)': 91.7, 'Availability (%)': 99.7},
    {'Mes': 'Abril', 'Call Date': '2025-04-21', 'HANDLED': 33, 'OIR (%)': 100.0, 'AHT (seg)': 670.2, 'PS & Compliance (%)': 100.0, 'RTA (%)': 91.9, 'Availability (%)': 99.9},
    {'Mes': 'Abril', 'Call Date': '2025-04-22', 'HANDLED': 36, 'OIR (%)': 100.0, 'AHT (seg)': 577.4, 'PS & Compliance (%)': 100.0, 'RTA (%)': 76.7, 'Availability (%)': 99.7},
    {'Mes': 'Abril', 'Call Date': '2025-04-23', 'HANDLED': 29, 'OIR (%)': 100.0, 'AHT (seg)': 550.9, 'PS & Compliance (%)': 50.0, 'RTA (%)': 75.1, 'Availability (%)': 99.8},
    {'Mes': 'Abril', 'Call Date': '2025-04-24', 'HANDLED': 39, 'OIR (%)': 100.0, 'AHT (seg)': 581.9, 'PS & Compliance (%)': 100.0, 'RTA (%)': 98.7, 'Availability (%)': 99.8},
    {'Mes': 'Abril', 'Call Date': '2025-04-26', 'HANDLED': 43, 'OIR (%)': 100.0, 'AHT (seg)': 452.4, 'PS & Compliance (%)': 100.0, 'RTA (%)': 96.9, 'Availability (%)': 99.1},
    {'Mes': 'Abril', 'Call Date': '2025-04-27', 'HANDLED': 16, 'OIR (%)': 100.0, 'AHT (seg)': 242.6, 'PS & Compliance (%)': 100.0, 'RTA (%)': 60.9, 'Availability (%)': 99.1},
    {'Mes': 'Abril', 'Call Date': '2025-04-28', 'HANDLED': 41, 'OIR (%)': 100.0, 'AHT (seg)': 529.1, 'PS & Compliance (%)': 100.0, 'RTA (%)': 94.1, 'Availability (%)': 99.0},

    # Mayo
    {'Mes': 'Mayo', 'Call Date': '2025-05-01', 'HANDLED': 33, 'OIR (%)': 100.0, 'AHT (seg)': 500.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 82.0, 'Availability (%)': 99.8},
    {'Mes': 'Mayo', 'Call Date': '2025-05-02', 'HANDLED': 29, 'OIR (%)': 100.0, 'AHT (seg)': 480.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 78.0, 'Availability (%)': 99.9},
    {'Mes': 'Mayo', 'Call Date': '2025-05-03', 'HANDLED': 35, 'OIR (%)': 100.0, 'AHT (seg)': 520.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 85.0, 'Availability (%)': 99.7},
    {'Mes': 'Mayo', 'Call Date': '2025-05-04', 'HANDLED': 32, 'OIR (%)': 100.0, 'AHT (seg)': 510.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 80.0, 'Availability (%)': 99.8},
    {'Mes': 'Mayo', 'Call Date': '2025-05-05', 'HANDLED': 38, 'OIR (%)': 100.0, 'AHT (seg)': 530.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 83.0, 'Availability (%)': 99.6},
    {'Mes': 'Mayo', 'Call Date': '2025-05-06', 'HANDLED': 31, 'OIR (%)': 100.0, 'AHT (seg)': 527.3, 'PS & Compliance (%)': 100.0, 'RTA (%)': 80.1, 'Availability (%)': 99.8},
    {'Mes': 'Mayo', 'Call Date': '2025-05-07', 'HANDLED': 10, 'OIR (%)': 100.0, 'AHT (seg)': 414.2, 'PS & Compliance (%)': 100.0, 'RTA (%)': 50.6, 'Availability (%)': 99.8},
    {'Mes': 'Mayo', 'Call Date': '2025-05-08', 'HANDLED': 30, 'OIR (%)': 100.0, 'AHT (seg)': 490.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 79.0, 'Availability (%)': 99.9},
    {'Mes': 'Mayo', 'Call Date': '2025-05-09', 'HANDLED': 34, 'OIR (%)': 100.0, 'AHT (seg)': 515.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 81.0, 'Availability (%)': 99.7},
    {'Mes': 'Mayo', 'Call Date': '2025-05-10', 'HANDLED': 31, 'OIR (%)': 100.0, 'AHT (seg)': 505.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 84.0, 'Availability (%)': 99.8},
    {'Mes': 'Mayo', 'Call Date': '2025-05-11', 'HANDLED': 37, 'OIR (%)': 100.0, 'AHT (seg)': 525.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 87.0, 'Availability (%)': 99.6},
    {'Mes': 'Mayo', 'Call Date': '2025-05-12', 'HANDLED': 33, 'OIR (%)': 100.0, 'AHT (seg)': 495.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 80.0, 'Availability (%)': 99.9},
    {'Mes': 'Mayo', 'Call Date': '2025-05-13', 'HANDLED': 36, 'OIR (%)': 100.0, 'AHT (seg)': 353.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 70.4, 'Availability (%)': 99.9},
    {'Mes': 'Mayo', 'Call Date': '2025-05-14', 'HANDLED': 44, 'OIR (%)': 100.0, 'AHT (seg)': 361.1, 'PS & Compliance (%)': 100.0, 'RTA (%)': 75.8, 'Availability (%)': 99.8},
    {'Mes': 'Mayo', 'Call Date': '2025-05-15', 'HANDLED': 30, 'OIR (%)': 100.0, 'AHT (seg)': 427.8, 'PS & Compliance (%)': 100.0, 'RTA (%)': 89.6, 'Availability (%)': 100.0},
    {'Mes': 'Mayo', 'Call Date': '2025-05-16', 'HANDLED': 37, 'OIR (%)': 100.0, 'AHT (seg)': 600.9, 'PS & Compliance (%)': 100.0, 'RTA (%)': 80.4, 'Availability (%)': 99.9},
    {'Mes': 'Mayo', 'Call Date': '2025-05-22', 'HANDLED': 40, 'OIR (%)': 75.0, 'AHT (seg)': 505.7, 'PS & Compliance (%)': 100.0, 'RTA (%)': 64.2, 'Availability (%)': 99.9},
    {'Mes': 'Mayo', 'Call Date': '2025-05-23', 'HANDLED': 38, 'OIR (%)': 100.0, 'AHT (seg)': 600.7, 'PS & Compliance (%)': 87.5, 'RTA (%)': 80.4, 'Availability (%)': 99.4},
    {'Mes': 'Mayo', 'Call Date': '2025-05-24', 'HANDLED': 38, 'OIR (%)': 100.0, 'AHT (seg)': 620.1, 'PS & Compliance (%)': 89.2, 'RTA (%)': 0.0, 'Availability (%)': 99.7},
    {'Mes': 'Mayo', 'Call Date': '2025-05-26', 'HANDLED': 15, 'OIR (%)': 100.0, 'AHT (seg)': 280.1, 'PS & Compliance (%)': 0.0, 'RTA (%)': 50.8, 'Availability (%)': 99.8},
    {'Mes': 'Mayo', 'Call Date': '2025-05-27', 'HANDLED': 40, 'OIR (%)': 100.0, 'AHT (seg)': 660.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 70.4, 'Availability (%)': 99.7},
    {'Mes': 'Mayo', 'Call Date': '2025-05-28', 'HANDLED': 36, 'OIR (%)': 100.0, 'AHT (seg)': 731.2, 'PS & Compliance (%)': None, 'RTA (%)': 75.7, 'Availability (%)': 99.0},
    {'Mes': 'Mayo', 'Call Date': '2025-05-29', 'HANDLED': 28, 'OIR (%)': 100.0, 'AHT (seg)': 767.8, 'PS & Compliance (%)': None, 'RTA (%)': 89.5, 'Availability (%)': 99.0},
    {'Mes': 'Mayo', 'Call Date': '2025-05-30', 'HANDLED': None, 'OIR (%)': None, 'AHT (seg)': None, 'PS & Compliance (%)': None, 'RTA (%)': None, 'Availability (%)': None},
    {'Mes': 'Mayo', 'Call Date': '2025-05-31', 'HANDLED': 38, 'OIR (%)': 100.0, 'AHT (seg)': 600.9, 'PS & Compliance (%)': 87.5, 'RTA (%)': 80.4, 'Availability (%)': 99.4},

    # Junio
    {'Mes': 'Junio', 'Call Date': '2025-06-01', 'HANDLED': 36, 'OIR (%)': 100.0, 'AHT (seg)': 540.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 90.0, 'Availability (%)': 99.7},
    {'Mes': 'Junio', 'Call Date': '2025-06-02', 'HANDLED': 32, 'OIR (%)': 100.0, 'AHT (seg)': 530.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 88.0, 'Availability (%)': 99.8},
    {'Mes': 'Junio', 'Call Date': '2025-06-03', 'HANDLED': 38, 'OIR (%)': 100.0, 'AHT (seg)': 560.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 85.0, 'Availability (%)': 99.6},
    {'Mes': 'Junio', 'Call Date': '2025-06-04', 'HANDLED': 30, 'OIR (%)': 100.0, 'AHT (seg)': 520.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 91.0, 'Availability (%)': 99.9},
    {'Mes': 'Junio', 'Call Date': '2025-06-05', 'HANDLED': 35, 'OIR (%)': 100.0, 'AHT (seg)': 550.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 93.0, 'Availability (%)': 99.7},
    {'Mes': 'Junio', 'Call Date': '2025-06-06', 'HANDLED': 34, 'OIR (%)': 100.0, 'AHT (seg)': 535.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 87.0, 'Availability (%)': 99.8},
    {'Mes': 'Junio', 'Call Date': '2025-06-07', 'HANDLED': 37, 'OIR (%)': 100.0, 'AHT (seg)': 545.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 89.0, 'Availability (%)': 99.6},
    {'Mes': 'Junio', 'Call Date': '2025-06-08', 'HANDLED': 33, 'OIR (%)': 100.0, 'AHT (seg)': 525.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 92.0, 'Availability (%)': 99.9},
    {'Mes': 'Junio', 'Call Date': '2025-06-09', 'HANDLED': 36, 'OIR (%)': 100.0, 'AHT (seg)': 570.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 86.0, 'Availability (%)': 99.7},
    {'Mes': 'Junio', 'Call Date': '2025-06-11', 'HANDLED': 29, 'OIR (%)': 100.0, 'AHT (seg)': 604.4, 'PS & Compliance (%)': None, 'RTA (%)': 73.1, 'Availability (%)': 99.5},
    {'Mes': 'Junio', 'Call Date': '2025-06-12', 'HANDLED': 30, 'OIR (%)': 100.0, 'AHT (seg)': 693.3, 'PS & Compliance (%)': None, 'RTA (%)': 89.7, 'Availability (%)': 99.7},
    {'Mes': 'Junio', 'Call Date': '2025-06-13', 'HANDLED': None, 'OIR (%)': None, 'AHT (seg)': None, 'PS & Compliance (%)': None, 'RTA (%)': None, 'Availability (%)': None},
    {'Mes': 'Junio', 'Call Date': '2025-06-14', 'HANDLED': 44, 'OIR (%)': 100.0, 'AHT (seg)': 572.5, 'PS & Compliance (%)': None, 'RTA (%)': 87.1, 'Availability (%)': 99.7},
    {'Mes': 'Junio', 'Call Date': '2025-06-16', 'HANDLED': 38, 'OIR (%)': 100.0, 'AHT (seg)': 647.2, 'PS & Compliance (%)': None, 'RTA (%)': 93.7, 'Availability (%)': 99.8},
    {'Mes': 'Junio', 'Call Date': '2025-06-17', 'HANDLED': 43, 'OIR (%)': 100.0, 'AHT (seg)': 548.3, 'PS & Compliance (%)': None, 'RTA (%)': 97.3, 'Availability (%)': 99.5},
    {'Mes': 'Junio', 'Call Date': '2025-06-18', 'HANDLED': 42, 'OIR (%)': 100.0, 'AHT (seg)': 555.7, 'PS & Compliance (%)': None, 'RTA (%)': 81.7, 'Availability (%)': 98.9},
    {'Mes': 'Junio', 'Call Date': '2025-06-19', 'HANDLED': 28, 'OIR (%)': 100.0, 'AHT (seg)': 743.8, 'PS & Compliance (%)': None, 'RTA (%)': 95.8, 'Availability (%)': 99.7},
    {'Mes': 'Junio', 'Call Date': '2025-06-21', 'HANDLED': 42, 'OIR (%)': 100.0, 'AHT (seg)': 550.5, 'PS & Compliance (%)': 87.5, 'RTA (%)': 92.1, 'Availability (%)': 99.8},
    {'Mes': 'Junio', 'Call Date': '2025-06-22', 'HANDLED': 31, 'OIR (%)': 100.0, 'AHT (seg)': 426.5, 'PS & Compliance (%)': 100.0, 'RTA (%)': 89.2, 'Availability (%)': 99.8},
    {'Mes': 'Junio', 'Call Date': '2025-06-23', 'HANDLED': 33, 'OIR (%)': 100.0, 'AHT (seg)': 784.6, 'PS & Compliance (%)': 100.0, 'RTA (%)': 82.7, 'Availability (%)': 99.4},
    {'Mes': 'Junio', 'Call Date': '2025-06-24', 'HANDLED': 24, 'OIR (%)': 100.0, 'AHT (seg)': 684.6, 'PS & Compliance (%)': 100.0, 'RTA (%)': 73.5, 'Availability (%)': 99.0},
    {'Mes': 'Junio', 'Call Date': '2025-06-25', 'HANDLED': 30, 'OIR (%)': 100.0, 'AHT (seg)': 706.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 92.8, 'Availability (%)': 99.0},
    {'Mes': 'Junio', 'Call Date': '2025-06-26', 'HANDLED': 35, 'OIR (%)': 100.0, 'AHT (seg)': 461.3, 'PS & Compliance (%)': 100.0, 'RTA (%)': 85.3, 'Availability (%)': 99.0},
    {'Mes': 'Junio', 'Call Date': '2025-06-28', 'HANDLED': 40, 'OIR (%)': 100.0, 'AHT (seg)': 529.1, 'PS & Compliance (%)': 100.0, 'RTA (%)': 94.9, 'Availability (%)': 99.9},

    # Julio
    {'Mes': 'Julio', 'Call Date': '2025-07-01', 'HANDLED': 35, 'OIR (%)': 100.0, 'AHT (seg)': 580.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 84.0, 'Availability (%)': 98.0},
    {'Mes': 'Julio', 'Call Date': '2025-07-02', 'HANDLED': 32, 'OIR (%)': 100.0, 'AHT (seg)': 560.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 80.0, 'Availability (%)': 97.5},
    {'Mes': 'Julio', 'Call Date': '2025-07-03', 'HANDLED': 38, 'OIR (%)': 100.0, 'AHT (seg)': 590.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 82.0, 'Availability (%)': 98.2},
    {'Mes': 'Julio', 'Call Date': '2025-07-04', 'HANDLED': 30, 'OIR (%)': 100.0, 'AHT (seg)': 540.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 85.0, 'Availability (%)': 97.8},
    {'Mes': 'Julio', 'Call Date': '2025-07-05', 'HANDLED': 34, 'OIR (%)': 100.0, 'AHT (seg)': 570.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 87.0, 'Availability (%)': 98.5},
    {'Mes': 'Julio', 'Call Date': '2025-07-06', 'HANDLED': 33, 'OIR (%)': 100.0, 'AHT (seg)': 550.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 83.0, 'Availability (%)': 98.0},
    {'Mes': 'Julio', 'Call Date': '2025-07-07', 'HANDLED': 37, 'OIR (%)': 100.0, 'AHT (seg)': 585.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 81.0, 'Availability (%)': 97.7},
    {'Mes': 'Julio', 'Call Date': '2025-07-08', 'HANDLED': 36, 'OIR (%)': 100.0, 'AHT (seg)': 565.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 86.0, 'Availability (%)': 98.3},
    {'Mes': 'Julio', 'Call Date': '2025-07-09', 'HANDLED': 31, 'OIR (%)': 100.0, 'AHT (seg)': 575.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 84.0, 'Availability (%)': 98.1},
    {'Mes': 'Julio', 'Call Date': '2025-07-10', 'HANDLED': 35, 'OIR (%)': 100.0, 'AHT (seg)': 560.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 88.0, 'Availability (%)': 97.9},
    {'Mes': 'Julio', 'Call Date': '2025-07-12', 'HANDLED': 31, 'OIR (%)': 100.0, 'AHT (seg)': 572.4, 'PS & Compliance (%)': 100.0, 'RTA (%)': 83.5, 'Availability (%)': 97.7},
    {'Mes': 'Julio', 'Call Date': '2025-07-13', 'HANDLED': 10, 'OIR (%)': 100.0, 'AHT (seg)': 414.2, 'PS & Compliance (%)': 100.0, 'RTA (%)': 80.9, 'Availability (%)': 95.3},
    {'Mes': 'Julio', 'Call Date': '2025-07-14', 'HANDLED': 36, 'OIR (%)': 100.0, 'AHT (seg)': 530.1, 'PS & Compliance (%)': 100.0, 'RTA (%)': 79.3, 'Availability (%)': 95.8},
    {'Mes': 'Julio', 'Call Date': '2025-07-15', 'HANDLED': 34, 'OIR (%)': 100.0, 'AHT (seg)': 361.1, 'PS & Compliance (%)': 86.3, 'RTA (%)': 91.7, 'Availability (%)': 97.6},
    {'Mes': 'Julio', 'Call Date': '2025-07-16', 'HANDLED': 30, 'OIR (%)': 100.0, 'AHT (seg)': 427.7, 'PS & Compliance (%)': 91.7, 'RTA (%)': 82.5, 'Availability (%)': 98.9},
    {'Mes': 'Julio', 'Call Date': '2025-07-17', 'HANDLED': 37, 'OIR (%)': 100.0, 'AHT (seg)': 529.2, 'PS & Compliance (%)': 82.5, 'RTA (%)': 76.9, 'Availability (%)': 99.0},
    {'Mes': 'Julio', 'Call Date': '2025-07-19', 'HANDLED': 31, 'OIR (%)': 100.0, 'AHT (seg)': 345.4, 'PS & Compliance (%)': 76.9, 'RTA (%)': 76.6, 'Availability (%)': 98.4},
    {'Mes': 'Julio', 'Call Date': '2025-07-20', 'HANDLED': 32, 'OIR (%)': 100.0, 'AHT (seg)': 501.6, 'PS & Compliance (%)': 74.6, 'RTA (%)': 80.4, 'Availability (%)': 98.3},
    {'Mes': 'Julio', 'Call Date': '2025-07-21', 'HANDLED': 40, 'OIR (%)': 100.0, 'AHT (seg)': 770.0, 'PS & Compliance (%)': 4.0, 'RTA (%)': 90.5, 'Availability (%)': 0.0},

    # Agosto
    {'Mes': 'Agosto', 'Call Date': '2025-08-01', 'HANDLED': 34, 'OIR (%)': 100.0, 'AHT (seg)': 610.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 89.0, 'Availability (%)': 99.8},
    {'Mes': 'Agosto', 'Call Date': '2025-08-02', 'HANDLED': 32, 'OIR (%)': 98.0, 'AHT (seg)': 590.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 87.0, 'Availability (%)': 99.7},
    {'Mes': 'Agosto', 'Call Date': '2025-08-03', 'HANDLED': 36, 'OIR (%)': 100.0, 'AHT (seg)': 620.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 85.0, 'Availability (%)': 99.6},
    {'Mes': 'Agosto', 'Call Date': '2025-08-04', 'HANDLED': 30, 'OIR (%)': 96.0, 'AHT (seg)': 580.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 91.0, 'Availability (%)':99.6},
    {'Mes': 'Agosto', 'Call Date': '2025-08-05', 'HANDLED': 38, 'OIR (%)': 100.0, 'AHT (seg)': 630.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 93.0,'Availability (%)': 99.7},
    {'Mes': 'Agosto', 'Call Date': '2025-08-07', 'HANDLED': 37, 'OIR (%)': 100.0, 'AHT (seg)': 615.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 88.0, 'Availability (%)': 99.6},
    {'Mes': 'Agosto', 'Call Date': '2025-08-08', 'HANDLED':35, 'OIR (%)': 99.0, 'AHT (seg)': 595.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 90.0, 'Availability (%)': 100.0},
    {'Mes': 'Agosto', 'Call Date': '2025-08-09', 'HANDLED': 31, 'OIR (%)': 100.0, 'AHT (seg)': 605.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 84.0, 'Availability (%)': 99.7},
    {'Mes': 'Agosto', 'Call Date': '2025-08-10', 'HANDLED': 34, 'OIR (%)': 98.0, 'AHT (seg)': 585.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 92.0, 'Availability (%)': 99.8},
    {'Mes': 'Agosto', 'Call Date': '2025-08-13', 'HANDLED': 9, 'OIR (%)': None, 'AHT (seg)': 826.6, 'PS & Compliance (%)': None, 'RTA (%)': 73.3, 'Availability (%)': 99.1},
    {'Mes': 'Agosto', 'Call Date': '2025-08-15', 'HANDLED': None, 'OIR (%)': None, 'AHT (seg)': None, 'PS & Compliance (%)': None, 'RTA (%)': None, 'Availability (%)': None},
    {'Mes': 'Agosto', 'Call Date': '2025-08-16', 'HANDLED': 94, 'OIR (%)': None, 'AHT (seg)': 95.6, 'PS & Compliance (%)': 100.0, 'RTA (%)': 87.2, 'Availability (%)': 98.8},
    {'Mes': 'Agosto', 'Call Date': '2025-08-18', 'HANDLED': 48, 'OIR (%)': 100.0, 'AHT (seg)': 297.9, 'PS & Compliance (%)': 100.0, 'RTA (%)': 89.7, 'Availability (%)': 98.5},
    {'Mes': 'Agosto', 'Call Date': '2025-08-19', 'HANDLED': 33, 'OIR (%)': 100.0, 'AHT (seg)': 620.1, 'PS & Compliance (%)': 87.5, 'RTA (%)': 86.2, 'Availability (%)': 99.7},
    {'Mes': 'Agosto', 'Call Date': '2025-08-20', 'HANDLED': 26, 'OIR (%)': 100.0, 'AHT (seg)': 653.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 84.2, 'Availability (%)': 99.0},
    {'Mes': 'Agosto', 'Call Date': '2025-08-22', 'HANDLED': 24, 'OIR (%)': 100.0, 'AHT (seg)': 527.3, 'PS & Compliance (%)': 87.5, 'RTA (%)': 77.8, 'Availability (%)': 97.3},
    {'Mes': 'Agosto', 'Call Date': '2025-08-23', 'HANDLED': 38, 'OIR (%)': 100.0, 'AHT (seg)': 620.1, 'PS & Compliance (%)': 0.0, 'RTA (%)': 92.8, 'Availability (%)': 99.7},
    {'Mes': 'Agosto', 'Call Date': '2025-08-23', 'HANDLED': None, 'OIR (%)': None, 'AHT (seg)': None, 'PS & Compliance (%)': None, 'RTA (%)': None, 'Availability (%)': None},
    {'Mes': 'Agosto', 'Call Date': '2025-08-24', 'HANDLED': 15, 'OIR (%)': 100.0, 'AHT (seg)': 280.1, 'PS & Compliance (%)': 100.0, 'RTA (%)': 50.8, 'Availability (%)': 99.8},
    {'Mes': 'Agosto', 'Call Date': '2025-08-26', 'HANDLED': 40, 'OIR (%)': 100.0, 'AHT (seg)': 660.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 70.4, 'Availability (%)': 99.7},
    {'Mes': 'Agosto', 'Call Date': '2025-08-27', 'HANDLED': 36, 'OIR (%)': 100.0, 'AHT (seg)': 731.2, 'PS & Compliance (%)': 100.0, 'RTA (%)': 75.7, 'Availability (%)': 99.9},
    {'Mes': 'Agosto', 'Call Date': '2025-08-28', 'HANDLED': 28, 'OIR (%)': 100.0, 'AHT (seg)': 767.8, 'PS & Compliance (%)': 0.0, 'RTA (%)': 89.5, 'Availability (%)': 99.9},
    {'Mes': 'Agosto', 'Call Date': '2025-08-29', 'HANDLED': 38, 'OIR (%)': 100.0, 'AHT (seg)': 600.9, 'PS & Compliance (%)': 87.5, 'RTA (%)': 80.4, 'Availability (%)': 99.4},
    {'Mes': 'Agosto', 'Call Date': '2025-08-30', 'HANDLED': 5, 'OIR (%)': 95.0, 'AHT (seg)': 550.0, 'PS & Compliance (%)': 0.0, 'RTA (%)': 5.0, 'Availability (%)': 5.0},
    {'Mes': 'Agosto', 'Call Date': '2025-08-31', 'HANDLED': 50, 'OIR (%)': 93.0, 'AHT (seg)': 550.0, 'PS & Compliance (%)': 0.0, 'RTA (%)': 0.0, 'Availability (%)': 0.0},

    # Septiembre
    {'Mes': 'Septiembre', 'Call Date': '2025-09-01', 'HANDLED': 33, 'OIR (%)': 91.0, 'AHT (seg)': 640.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 75.0, 'Availability (%)': 95.0},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-02', 'HANDLED': 30, 'OIR (%)': 94.0, 'AHT (seg)': 620.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 78.0, 'Availability (%)': 96.0},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-03', 'HANDLED': 36, 'OIR (%)': 93.0, 'AHT (seg)': 650.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 80.0, 'Availability (%)': 94.0},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-04', 'HANDLED': 32, 'OIR (%)': 95.0, 'AHT (seg)': 630.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 82.0, 'Availability (%)': 97.0},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-05', 'HANDLED': 38, 'OIR (%)': 90.0, 'AHT (seg)': 660.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 77.0, 'Availability (%)': 95.0},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-06', 'HANDLED': 34, 'OIR (%)': 96.0, 'AHT (seg)': 640.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 79.0, 'Availability (%)': 96.0},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-07', 'HANDLED': 31, 'OIR (%)': 92.0, 'AHT (seg)': 670.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 81.0, 'Availability (%)': 94.0},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-08', 'HANDLED': 35, 'OIR (%)': 94.0, 'AHT (seg)': 625.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 83.0, 'Availability (%)': 97.0},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-09', 'HANDLED': 37, 'OIR (%)': 93.0, 'AHT (seg)': 655.0, 'PS & Compliance (%)': 75.0, 'RTA (%)': 76.0, 'Availability (%)': 95.0},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-10', 'HANDLED': 33, 'OIR (%)': 95.0, 'AHT (seg)': 645.0, 'PS & Compliance (%)': 100.0, 'RTA (%)': 80.0, 'Availability (%)': 96.0},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-10', 'HANDLED': 34, 'OIR (%)': 100.0, 'AHT (seg)': 609.2, 'PS & Compliance (%)': 33.3, 'RTA (%)': 89.6, 'Availability (%)': 99.9},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-11', 'HANDLED': 25, 'OIR (%)': 100.0, 'AHT (seg)': 572.4, 'PS & Compliance (%)': 100.0, 'RTA (%)': 25.6, 'Availability (%)': 96.9},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-13', 'HANDLED': 33, 'OIR (%)': 100.0, 'AHT (seg)': 713.6, 'PS & Compliance (%)': 50.0, 'RTA (%)': 94.3, 'Availability (%)': 99.7},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-14', 'HANDLED': 19, 'OIR (%)': None, 'AHT (seg)': 306.2, 'PS & Compliance (%)': None, 'RTA (%)': 85.0, 'Availability (%)': 100.0},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-15', 'HANDLED': None, 'OIR (%)': None, 'AHT (seg)': None, 'PS & Compliance (%)': None, 'RTA (%)': None, 'Availability (%)': None},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-16', 'HANDLED': 23, 'OIR (%)': 100.0, 'AHT (seg)': 904.2, 'PS & Compliance (%)': 50.0, 'RTA (%)': 87.5, 'Availability (%)': 99.2},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-17', 'HANDLED': 31, 'OIR (%)': 100.0, 'AHT (seg)': 598.4, 'PS & Compliance (%)': None, 'RTA (%)': 89.5, 'Availability (%)': 99.8},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-22', 'HANDLED': 32, 'OIR (%)': 100.0, 'AHT (seg)': 794.7, 'PS & Compliance (%)': 87.5, 'RTA (%)': 72.5, 'Availability (%)': 94.4},
    {'Mes': 'Septiembre', 'Call Date': '2025-09-09', 'HANDLED': 27, 'OIR (%)': 100.0, 'AHT (seg)': 740.4, 'PS & Compliance (%)': None, 'RTA (%)': 85.2, 'Availability (%)': 100.0},
]

# -----------------------------------------------------------------------------
# Ordena la lista por mes y fecha (por si agregas datos nuevos)
# -----------------------------------------------------------------------------
def parse_date(row):
    try:
        return datetime.strptime(row['Call Date'], "%Y-%m-%d")
    except Exception:
        return datetime.min

daily_data = sorted(daily_data, key=lambda x: (x['Mes'], parse_date(x)))

# -----------------------------------------------------------------------------
# 3. DATAFRAME DE EQUIPO (métricas por empleado)
# -----------------------------------------------------------------------------
data_equipo = {
    'Empleado': [
        'Christian Velasco Navarro', 'Teresa Cervantes', 'Carlos Miguel', 'Torre Roberto', 'De La Cruz Paola',
        'Ramiro Partida', 'Villela Stefania', 'Izaguirre Itzel', 'Silva Bernal', 'Delgado Rafael',
        'Velasco Estrada', 'Gabriel Araceli', 'Soriano Madriz', 'Alvarez Danila'
    ],
    'OIR (%)': [95.12, 94.76, 93.53, 93.90, 93.65, 92.49, 98.31, 81.98, 70.0, 100.0, 100.0, 93.85, 92.81, 83.33],
    'Silence Percentage (%)': [38.4, 47.6, 42.6, 45.5, 38.98, 34.0, 41.7, 38.47, 45.0, 45.02, 48.0, 49.0, 46.32, 51.18],
    'CCA (%)': [75.2, 98.0, 100.0, 100.0, 80.77, 85.33, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
    'CARE (%)': [7.36, 0.0, 8.58, 10.0, 6.36, 7.32, 10.0, 5.77, 4.67, 1.0, 0.0, 3.87, 0.7, 0.0],
    'NICE TOUR (%)': [70.5, 75.0, 84.33, 71.38, 82.14, 63.30, 50.0, 85.0, 95.83, 75.0, 73.44, 95.10, 90.0, 90.0],
    'QA (%)': [85.0, 90.0, 90.5, 70.52, 52.0, 67.0, 100.0, 87.22, 100.0, 100.0, 100.0, 92.5, 95.0, 70.0],
    'ACS Score (%)': [89.0, 90.0, 94.4, 97.3, 70.5, 100.0, 100.0, 84.8, 0.0, 100.0, 90.7, 92.3, 85.33, 83.33],
    'Availability (%)': [96.51, 99.49, 99.79, 99.28, 95.96, 99.96, 98.31, 98.79, 99.74, 95.29, 99.83, 99.78, 83.35, 93.0],
    'RTA (%)': [82.94, 93.3, 88.42, 84.33, 83.06, 65.96, 82.31, 70.72, 80.96, 100.0, 73.1, 70.0, 75.0, 66.0],
    'PS & Compliance (%)': [86.16, 88.4, 93.28, 84.55, 83.27, 90.16, 86.33, 44.95, 98.57, 91.67, 100.0, 82.79, 85.7, 82.67],
    'AHT': [633, 655.7, 637.8, 922.8, 606.3, 890, 772.5, 609.9, 506.6, 486, 450, 440, 384, 381]
}
df_equipo = pd.DataFrame(data_equipo)

# -----------------------------------------------------------------------------
# 4. METAS DE CADA MÉTRICA (para semáforos y validaciones)
# -----------------------------------------------------------------------------
metas = {
    'OIR (%)': 90.0,
    'AHT (seg)': 630.0,
    'QA (%)': 85.0,
    'ACS (%)': 70.0,
    'PS & Compliance (%)': 80.0,
    'RTA (%)': 85.0,
    'CCA (%)': 90.0,
    'CARE (%)': 5.0,
    'NICE TOUR (%)': 80.0,
    'ACS Score (%)': 85.0,
    'Silence Percentage (%)': 40.0
}

# -----------------------------------------------------------------------------
# 5. FUNCIONES AUXILIARES
# -----------------------------------------------------------------------------
def excel_col_letter(col_idx):
    """Convierte índice de columna a letra de Excel (A, B, C, ...)."""
    return xl_col_to_name(col_idx)

# -----------------------------------------------------------------------------
# 6. RUTA DE SALIDA DEL ARCHIVO EXCEL
# -----------------------------------------------------------------------------
output_file = r'Reporte_Metricas_Christian_modified.xlsx'

# =============================================================================
# 7. PROCESO PRINCIPAL: Escritura de datos y métricas en Excel
# =============================================================================
try:
    with pd.ExcelWriter(output_file, engine='xlsxwriter') as writer:
        workbook = writer.book

        # ------------------ FORMATOS DE CELDA ------------------
        fmt_header = workbook.add_format({
            'bold': True, 'bg_color': '#4F81BD', 'font_color': 'white',
            'align': 'center', 'font_size': 12
        })
        fmt_bold = workbook.add_format({'bold': True, 'font_size': 11})
        fmt_int = workbook.add_format({'num_format': '0', 'font_size': 11})
        fmt_round0 = workbook.add_format({'num_format': '0', 'font_size': 11})

        fmt_dark_green = workbook.add_format({'bg_color': '#008000', 'font_size': 11})
        fmt_light_green = workbook.add_format({'bg_color': '#90EE90', 'font_size': 11})
        fmt_yellow = workbook.add_format({'bg_color': '#FFFF00', 'font_size': 11})
        fmt_red = workbook.add_format({'bg_color': '#FF0000', 'font_size': 11})

        def add_traffic_light(ws, col_idx, target, menor_mejor=False, first_row=1, last_row=None):
            """
            Aplica formato condicional tipo semáforo a una columna de la hoja Excel.
            - ws: worksheet
            - col_idx: índice de columna
            - target: valor meta
            - menor_mejor: si True, valores menores son mejores
            - first_row, last_row: rango de filas
            """
            if last_row is None:
                last_row = ws.dim_rowmax
            col_letter = excel_col_letter(col_idx)
            rng = f'{col_letter}{first_row+1}:{col_letter}{last_row+1}'
            if menor_mejor:
                ws.conditional_format(rng, {'type':'cell', 'criteria':'<=', 'value': target, 'format': fmt_dark_green})
                ws.conditional_format(rng, {'type':'cell', 'criteria':'<=', 'value': target*1.05, 'format': fmt_light_green})
                ws.conditional_format(rng, {'type':'cell', 'criteria':'<=', 'value': target*1.15, 'format': fmt_yellow})
                ws.conditional_format(rng, {'type':'cell', 'criteria':'>', 'value': target*1.15, 'format': fmt_red})
            else:
                ws.conditional_format(rng, {'type':'cell', 'criteria':'>=', 'value': target, 'format': fmt_dark_green})
                ws.conditional_format(rng, {'type':'cell', 'criteria':'>=', 'value': target*0.95, 'format': fmt_light_green})
                ws.conditional_format(rng, {'type':'cell', 'criteria':'>=', 'value': target*0.9, 'format': fmt_yellow})
                ws.conditional_format(rng, {'type':'cell', 'criteria':'<', 'value': target*0.9, 'format': fmt_red})

        # ---------------------------------------------------------------------
        # HOJA 1: Daily_Data (tablas por mes, sin Availability)
        # ---------------------------------------------------------------------
        sheet_daily = 'Daily_Data'
        ws = workbook.add_worksheet(sheet_daily)
        writer.sheets[sheet_daily] = ws

        df_daily = pd.DataFrame(daily_data)
        grouped = df_daily.groupby('Mes')
        current_row = 0
        styles = ['Table Style Medium 9', 'Table Style Medium 2', 'Table Style Medium 3', 'Table Style Medium 4']
        i = 0

        for mes, df_group in grouped:
            # Elimina columna 'Availability (%)' para la tabla diaria
            df_group2 = df_group.drop(columns=['Availability (%)'], errors='ignore').copy()

            # Escribe el nombre del mes como encabezado
            ws.write(current_row, 0, f'Mes: {mes}', fmt_header)
            current_row += 1

            # Escribe los datos (incluye encabezados)
            df_group2.to_excel(writer, sheet_name=sheet_daily, index=False, startrow=current_row, header=True)

            rows_group = len(df_group2)
            cols = len(df_group2.columns)
            last_col = cols - 1

            # Agrega la tabla de Excel
            table_range = f'A{current_row+1}:{excel_col_letter(last_col)}{current_row + rows_group +1}'
            columns = [{'header': c} for c in df_group2.columns]
            ws.add_table(table_range, {'columns': columns, 'style': styles[i % len(styles)]})

            # Fila de promedio (sin decimales)
            avg_row = current_row + rows_group + 2
            ws.write(avg_row-1, 0, 'Average', fmt_bold)
            for cidx, col in enumerate(df_group2.columns):
                if pd.api.types.is_numeric_dtype(df_group2[col]):
                    col_letter = excel_col_letter(cidx)
                    start = current_row + 2
                    end = current_row + rows_group +1
                    formula = f'=ROUND(AVERAGE({col_letter}{start}:{col_letter}{end}),0)'
                    ws.write_formula(avg_row-1, cidx, formula)

            # Ajusta el ancho de columnas
            for j, col in enumerate(df_group2.columns):
                max_len = max(df_group2[col].astype(str).map(len).max(), len(col)) + 4
                ws.set_column(j, j, max_len)

            # Aplica semáforo a métricas relevantes
            daily_col_map_group = {c: j for j, c in enumerate(df_group2.columns)}
            for metric in ['OIR (%)', 'AHT (seg)', 'PS & Compliance (%)', 'RTA (%)']:
                if metric in metas and metric in daily_col_map_group:
                    menor = True if metric in ['AHT (seg)'] else False
                    add_traffic_light(ws, daily_col_map_group[metric], metas[metric], menor_mejor=menor, first_row=current_row, last_row=current_row + rows_group)

            # Añade mini-gráfica OIR vs AHT para el mes
            if ('OIR (%)' in df_group2.columns) and ('AHT (seg)' in df_group2.columns) and ('Call Date' in df_group2.columns):
                idx_date = df_group2.columns.get_loc('Call Date')
                idx_oir = df_group2.columns.get_loc('OIR (%)')
                idx_aht = df_group2.columns.get_loc('AHT (seg)')
                chart = workbook.add_chart({'type': 'line'})
                chart.add_series({
                    'name': 'OIR (%)',
                    'categories': [sheet_daily, current_row+1, idx_date, current_row+rows_group, idx_date],
                    'values':     [sheet_daily, current_row+1, idx_oir, current_row+rows_group, idx_oir],
                })
                chart.add_series({
                    'name': 'AHT (seg)',
                    'categories': [sheet_daily, current_row+1, idx_date, current_row+rows_group, idx_date],
                    'values':     [sheet_daily, current_row+1, idx_aht, current_row+rows_group, idx_aht],
                    'y2_axis': True
                })
                chart.set_title({'name': f'{mes}: OIR vs AHT'})
                chart.set_size({'width': 360, 'height': 200})
                insert_col = last_col + 2
                insert_cell = f'{excel_col_letter(insert_col)}{current_row+1}'
                ws.insert_chart(insert_cell, chart)

            # Espacio antes del siguiente mes
            current_row = avg_row + 2
            i += 1

        # ---------------------------------------------------------------------
        # HOJA 2: Team_August (sin Availability, AHT, Silence)
        # ---------------------------------------------------------------------
        sheet_team = 'Team_August'
        df_team2 = df_equipo.drop(columns=['Availability (%)', 'AHT', 'Silence Percentage (%)'], errors='ignore').copy()
        df_team2.to_excel(writer, sheet_name=sheet_team, index=False, startrow=0)
        ws_t = writer.sheets[sheet_team]
        r_t, c_t = df_team2.shape
        last_col_t = c_t - 1

        table_range_t = f'A1:{excel_col_letter(last_col_t)}{r_t+1}'
        columns_t = [{'header': c} for c in df_team2.columns]
        ws_t.add_table(table_range_t, {'columns': columns_t, 'style':'Table Style Medium 9'})

        # Fila de promedio
        avg_row_t = r_t + 2
        ws_t.write(avg_row_t-1, 0, 'Average', fmt_bold)
        for cidx, col in enumerate(df_team2.columns):
            if pd.api.types.is_numeric_dtype(df_team2[col]):
                col_letter = excel_col_letter(cidx)
                formula = f'=ROUND(AVERAGE({col_letter}2:{col_letter}{r_t+1}),0)'
                ws_t.write_formula(avg_row_t-1, cidx, formula)

        # Ajuste de anchos
        for i_col, col in enumerate(df_team2.columns):
            max_len = max(df_team2[col].astype(str).map(len).max(), len(col)) + 4
            ws_t.set_column(i_col, i_col, max_len)

        # Semáforo en Team para métricas restantes
        for cidx, col in enumerate(df_team2.columns):
            if col in metas:
                menor = True if col in ['CARE (%)'] else False
                add_traffic_light(ws_t, cidx, metas[col], menor_mejor=menor, first_row=1, last_row=r_t)

        # Gráfico de ranking de OIR
        if 'OIR (%)' in df_team2.columns:
            chart_team = workbook.add_chart({'type':'bar'})
            chart_team.add_series({
                'name': 'OIR (%)',
                'categories': [sheet_team, 1, 0, r_t, 0],
                'values':     [sheet_team, 1, df_team2.columns.get_loc('OIR (%)'), r_t, df_team2.columns.get_loc('OIR (%)')]
            })
            chart_team.set_title({'name': 'Team Ranking by OIR (%)'})
            chart_team.set_x_axis({'name': 'OIR (%)'})
            chart_team.set_size({'width': 720, 'height': 400})
            ws_t.insert_chart('P2', chart_team)

    print(f'Archivo Excel generado: {output_file}')

except PermissionError as e:
    # Mensaje claro si el archivo está abierto o no hay permisos
    print(f"Error: No se puede escribir en el archivo '{output_file}' debido a un problema de permisos.")
    print("1) Cierra el archivo en Excel si está abierto.")
    print("2) Asegúrate de tener permisos de escritura en la carpeta.")
    print("3) O cambia la ruta de output_file a otra carpeta.")
    print(f"Detalles del error: {e}")

except Exception as e:
    # Mensaje para cualquier otro error inesperado
    print(f"Se produjo un error inesperado: {e}")

# =============================================================================
# FIN DEL SCRIPT
# =============================================================================